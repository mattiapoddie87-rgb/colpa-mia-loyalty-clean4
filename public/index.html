<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Colpa Mia Loyalty</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <header>
    <h1>☕ Colpa Mia Loyalty</h1>
    <p>Ricarica i tuoi minuti di vita con un click.</p>
  </header>

  <main>
    <section class="pricing">
      <h2>Ricarica Minuti</h2>
      <button onclick="checkout(1, 10, 'Ricarica 10 minuti')">1€ → 10 minuti</button>
      <button onclick="checkout(5, 60, 'Ricarica 60 minuti')">5€ → 60 minuti</button>
      <button onclick="checkout(10, 140, 'Ricarica 140 minuti')">10€ → 140 minuti</button>
    </section>

    <section class="about">
      <h2>Come funziona?</h2>
      <p>Paghi con Stripe, torni qui, i minuti sono accreditati. Fine.</p>
    </section>

    <section class="contact">
      <h2>Contattaci</h2>
      <form name="contact" method="POST" data-netlify="true">
        <input type="text" name="name" placeholder="Nome" required />
        <input type="email" name="email" placeholder="Email" required />
        <textarea name="message" placeholder="Messaggio" required></textarea>
        <button type="submit">Invia</button>
      </form>
    </section>
  </main>

  <footer>
    <p>© 2025 Colpa Mia</p>
  </footer>

  <script>
    async function checkout(price, minutes, label) {
      const res = await fetch("/.netlify/functions/create-checkout-session", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ price_eur: price, redeem_minutes: minutes, service: label })
      });
      const data = await res.json();
      if (data && data.url) window.location.href = data.url;
      else alert("Errore: impossibile creare la sessione di pagamento");
    }
  </script>
</body>
</html>
