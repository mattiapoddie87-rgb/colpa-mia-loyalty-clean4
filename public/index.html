<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Colpa Mia ‚Äî Scuse On-Demand</title>
  <meta name="description" content="Scegli la scusa, ricarica i ‚ÄòMinuti di Vita‚Äô, paga in 10 secondi con Stripe. Checkout sicuro.">

  <!-- Stili principali del sito -->
  <link rel="stylesheet" href="/styles.css?v=8" />

  <!-- ======= CYBERPUNK BACKGROUND (INLINE CSS) ======= -->
  <style>
    /* Canvas fisso dietro a tutto */
    #cp-bg-canvas {
      position: fixed;
      inset: 0;
      z-index: 0;           /* dietro a tutto il contenuto (che ha z-index auto/1) */
      pointer-events: none; /* non blocca click/scroll */
      width: 100vw;
      height: 100vh;
      display: block;
    }
    /* Vignettatura/gradiente leggero sopra il canvas per contrasto */
    #cp-bg-overlay {
      position: fixed;
      inset: 0;
      z-index: 1;
      pointer-events: none;
      background:
        radial-gradient(1200px 800px at 80% 20%, rgba(0,255,255,0.15), transparent 60%),
        radial-gradient(900px 700px at 20% 80%, rgba(255,0,180,0.12), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.6));
      mix-blend-mode: screen; /* dona un glow leggero */
    }
    /* Riduci animazione se l‚Äôutente lo richiede */
    @media (prefers-reduced-motion: reduce) {
      #cp-bg-canvas { display: none; }
      #cp-bg-overlay { background: linear-gradient(180deg, rgba(0,0,0,0.4), rgba(0,0,0,0.65)); }
    }
    /* Il resto del tuo layout deve stare sopra (z-index naturale) */
    body > header, body > main, body > footer { position: relative; z-index: 2; }
  </style>
</head>
<body>
  <!-- ======= CYBERPUNK BACKGROUND (INLINE NODES) ======= -->
  <canvas id="cp-bg-canvas"></canvas>
  <div id="cp-bg-overlay" aria-hidden="true"></div>

  <!-- Topbar -->
  <header class="topbar">
    <div class="wrap topbar__inner">
      <div class="brand">COLPA MIA</div>
      <nav class="nav">
        <a href="#catalogo">Catalogo</a>
        <a href="#premium">Premium</a>
        <a href="/wallet.html">Wallet</a>
        <a href="#faq">FAQ</a>
      </nav>
    </div>
  </header>

  <main>
    <!-- Hero -->
    <section class="hero">
      <div class="wrap">
        <h1 class="hero__title">Trova sempre la scusa perfetta</h1>
        <p class="hero__sub">
          Ricarica ‚ÄúMinuti di Vita‚Äù in 10 secondi. Checkout sicuro con Stripe. Zero complicazioni.
        </p>
        <a class="btn btn--xl btn--primary" href="#premium">üîí Scopri i pacchetti premium</a>
      </div>
    </section>

    <!-- Catalogo -->
    <section class="wrap section" id="catalogo" aria-label="Pacchetti">
      <h2>Catalogo</h2>
      <div id="grid" class="grid"></div>
      <div id="msg" class="msg" hidden></div>
    </section>

    <!-- Premium -->
    <section class="wrap section" id="premium" aria-label="Prodotti Premium">
      <h2>Prodotti Premium (solo con punti)</h2>
      <p class="hero__sub">Sblocca contenuti speciali usando i tuoi minuti accumulati (punti).</p>
      <div id="premium-grid" class="grid"></div>
      <div id="premium-msg" class="msg" hidden></div>
    </section>

    <!-- FAQ -->
    <section id="faq" class="wrap section">
      <h2>FAQ</h2>

      <details>
        <summary>Come funziona il pagamento?</summary>
        <p>Usiamo Stripe Checkout. Selezioni il pacchetto, inserisci carta, confermi: fatto. Torni qui alla pagina di conferma.</p>
      </details>

      <details>
        <summary>Quando vedo i minuti e i punti?</summary>
        <p>Subito dopo il pagamento. Vai su <a href="/wallet.html">Wallet</a>, inserisci la tua email e trovi il totale minuti acquistati e i punti.</p>
      </details>

      <details>
        <summary>Posso usare coupon o codici promo?</summary>
        <p>S√¨, se attivi i codici in Stripe, il checkout li accetta (impostazione lato Stripe).</p>
      </details>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="wrap footer__inner">
      <small>¬© <span id="year"></span> Colpa Mia ‚Äî Netlify + GitHub + Stripe</small>
      <div class="links">
        <a href="#">Privacy</a>
        <a href="#">Termini</a>
      </div>
    </div>
  </footer>

  <noscript>
    <div style="position:fixed;bottom:0;left:0;right:0;background:#111;color:#fff;padding:.75rem 1rem;font:14px/1.4 system-ui,Segoe UI,Roboto,sans-serif;z-index:9999;">
      Questo sito usa JavaScript per il catalogo e lo sfondo dinamico. Abilitalo per la migliore esperienza.
    </div>
  </noscript>

  <!-- Script applicazione -->
  <script src="/shop.js?v=8" defer></script>
  <script src="/premium.js?v=8" defer></script>

  <!-- ======= CYBERPUNK BACKGROUND (INLINE JS) ======= -->
  <script>
    (function () {
      const canvas = document.getElementById('cp-bg-canvas');
      const ctx = canvas.getContext('2d', { alpha: true });
      let w = canvas.width = window.innerWidth;
      let h = canvas.height = window.innerHeight;

      // Griglia ‚Äúpcb‚Äù
      const GRID = 34;        // dimensione celle
      const LINES = 70;       // quante tracce simultanee
      const SPEED = 0.9;      // velocit√† animazione
      const PULSE_CHANCE = 0.02; // probabilit√† di bagliore locale
      const colors = [
        'rgba(0,255,255,',    // cyan
        'rgba(255,0,180,',    // magenta
        'rgba(255,190,0,'     // amber
      ];

      // Precompute nodi della griglia
      let cols, rows, nodes;
      function buildGrid() {
        cols = Math.ceil(w / GRID) + 2;
        rows = Math.ceil(h / GRID) + 2;
        nodes = new Array(cols * rows);
        for (let y = 0; y < rows; y++) {
          for (let x = 0; x < cols; x++) {
            const i = y * cols + x;
            nodes[i] = {
              x: x * GRID - GRID/2,
              y: y * GRID - GRID/2
            };
          }
        }
      }
      buildGrid();

      function rnd(a, b) { return Math.random() * (b - a) + a; }
      function pick(arr) { return arr[(Math.random() * arr.length) | 0]; }

      // ‚ÄúTracce‚Äù in movimento sulla griglia
      function makeTrace() {
        return {
          x: (Math.random() * cols) | 0,
          y: (Math.random() * rows) | 0,
          dir: (Math.random() * 4) | 0, // 0=E 1=S 2=W 3=N
          life: rnd(60, 220),
          hue: pick(colors),
          w: rnd(1.2, 2.2),
          glow: rnd(8, 18),
          alpha: rnd(0.25, 0.55)
        };
      }
      const traces = Array.from({ length: LINES }, makeTrace);

      function step(t) {
        // Fade morbido dello sfondo per ‚Äúscie‚Äù
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = 'rgba(5,10,18,0.28)'; // base scura
        ctx.fillRect(0, 0, w, h);

        ctx.globalCompositeOperation = 'lighter';
        for (let tr of traces) {
          // piccola possibilit√† di impulso locale
          if (Math.random() < PULSE_CHANCE) tr.glow = rnd(12, 28);

          // disegna un segmento
          const i = tr.y * cols + tr.x;
          const n = nodes[i];
          if (!n) { Object.assign(tr, makeTrace()); continue; }

          ctx.lineWidth = tr.w;
          ctx.shadowBlur = tr.glow;
          ctx.shadowColor = tr.hue + '1)';
          ctx.strokeStyle = tr.hue + tr.alpha + ')';

          ctx.beginPath();
          ctx.moveTo(n.x, n.y);

          // direzione
          if (tr.dir === 0) tr.x++;
          else if (tr.dir === 1) tr.y++;
          else if (tr.dir === 2) tr.x--;
          else tr.y--;

          // cambio direzione casuale ogni tanto
          if (Math.random() < 0.25) {
            tr.dir = (tr.dir + (Math.random() < 0.5 ? 1 : 3)) & 3;
          }

          // clamp & respawn se esce
          tr.x = Math.max(0, Math.min(cols - 1, tr.x));
          tr.y = Math.max(0, Math.min(rows - 1, tr.y));
          const j = tr.y * cols + tr.x;
          const m = nodes[j];
          ctx.lineTo(m.x, m.y);
          ctx.stroke();

          tr.life -= SPEED;
          if (tr.life <= 0 || j === i) {
            Object.assign(tr, makeTrace());
          }
        }
        requestAnimationFrame(step);
      }
      requestAnimationFrame(step);

      function resize() {
        const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
        canvas.width = (w = window.innerWidth) * dpr;
        canvas.height = (h = window.innerHeight) * dpr;
        canvas.style.width = w + 'px';
        canvas.style.height = h + 'px';
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        buildGrid();
      }
      window.addEventListener('resize', resize, { passive: true });
      resize();

      // Pausa quando la tab non √® visibile
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) ctx.fillRect(0,0,w,h);
      });

      // Debug flag
      window.CP_BG_READY = true;
      console.log('[CP] background ready');
    })();
  </script>

  <script>
    // anno footer + smooth scroll
    document.getElementById('year').textContent = new Date().getFullYear();
    document.documentElement.style.scrollBehavior = 'smooth';
  </script>
</body>
</html>
