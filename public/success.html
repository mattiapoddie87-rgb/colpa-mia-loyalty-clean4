<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Grazie — COLPA MIA</title>
<style>
body{margin:0;background:#0b0f16;color:#e9eef5;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif}
.wrap{max-width:900px;margin:24px auto;padding:0 16px}
a.btn{padding:10px 14px;border-radius:12px;border:1px solid #2b3150;background:#0c0f17;color:#e6e6e6;text-decoration:none}
textarea{width:100%;min-height:160px;padding:12px;border-radius:12px;border:1px solid #2b3150;background:#0c0f17;color:#e6e6e6}
.note{color:#9fb0c9;margin-bottom:12px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Pagamento riuscito</h1>
  <p class="note">Stiamo generando la tua scusa...</p>
  <textarea id="result" readonly>Generazione in corso…</textarea>
  <div style="margin-top:10px"><a class="btn" href="/#catalogo">↩ Torna al catalogo</a></div>
</div>
<script>
(async function(){
  const sessionId=new URLSearchParams(location.search).get('session_id');
  if(!sessionId){document.getElementById('result').value='Sessione non trovata.';return;}
  try{
    const r=await fetch('/.netlify/functions/post-checkout?session_id='+encodeURIComponent(sessionId));
    const d=await r.json();
    document.getElementById('result').value=d.excuse||d.message||'Errore: nessun testo.';
  }catch(e){
    document.getElementById('result').value='Errore: '+e.message;
  }
})();
</script>
</body>
</html>
