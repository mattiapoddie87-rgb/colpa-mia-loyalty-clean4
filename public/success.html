<!-- public/success.html -->
<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Grazie! – Colpa Mia</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <main class="wrap section">
    <h1>Pagamento riuscito ✅</h1>
    <p id="msg">Stiamo collegando il tuo Wallet…</p>
    <div id="cta" style="display:none">
      <a id="linkWallet" class="btn" href="#">Vedi saldo</a>
      <a id="linkPremium" class="btn" href="#">Sblocca Premium</a>
      <a class="btn" href="/">Torna alla Home</a>
    </div>
  </main>

  <script>
  (async ()=>{
    const p = new URLSearchParams(location.search);
    const sid = p.get('sid');
    try{
      const r = await fetch('/.netlify/functions/session-email?sid=' + encodeURIComponent(sid));
      const j = await r.json();
      const email = j.email || '';
      if(email){
        const w = document.getElementById('linkWallet');
        const pr = document.getElementById('linkPremium');
        w.href = '/wallet.html?email=' + encodeURIComponent(email);
        pr.href = '/index.html#premium';
        document.getElementById('msg').textContent = `Email collegata: ${email}`;
        document.getElementById('cta').style.display = 'flex';
        document.getElementById('cta').style.gap = '10px';
      }else{
        document.getElementById('msg').textContent = 'Non abbiamo potuto collegare automaticamente la tua email.';
      }
    }catch(e){
      document.getElementById('msg').textContent = 'Errore durante il collegamento.';
      console.error(e);
    }
  })();
  </script>
</body>
</html>
